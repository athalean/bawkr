// Generated by CoffeeScript 1.7.1
(function() {
  var app;

  app = angular.module('Bawkr', []);

  app.controller('BawkrController', [
    '$scope', '$http', function($scope, $http) {
      $scope.username = '';
      $scope.signedin = false;
      $scope.connection = 'connecting';
      $scope.socket = null;
      $scope.bawks = [];
      $scope.message = '';
      $scope.refreshBawks = function() {
        return $http.get('/bawks').success(function(e) {
          return $scope.bawks = e.bawks;
        });
      };
      $scope.signIn = function() {
        return $scope.signedin = true;
      };
      $scope.postMessage = function() {
        return $scope.socket.send('MSG\n' + $scope.username + '\n' + $scope.message);
      };
      $scope.socketConnect = function() {
        $scope.socket = new WebSocket('ws://' + window.location.host + '/stream/');
        $scope.socket.onopen = function() {
          $scope.connection = 'connected';
          return $scope.$apply();
        };
        $scope.socket.onmessage = function(e) {
          if (e.data === 'PING') {
            return;
          }
          $scope.bawks.unshift(JSON.parse(e.data));
          return $scope.$apply();
        };
        $scope.socket.onerror = function(error) {
          $scope.connection = "closed";
          return alert("No connection possible :-(");
        };
        return $scope.socket.onclose = function() {
          $scope.connection = 'connecting';
          return setTimeout($scope.socketConnect, 10);
        };
      };
      setTimeout($scope.refreshBawks, 10);
      return setTimeout($scope.socketConnect, 10);
    }
  ]);

}).call(this);
