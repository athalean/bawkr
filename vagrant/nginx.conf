server {
	listen 80 default_server;
	listen [::]:80 default_server ipv6only=on;

	root /vagrant;
	index index.html index.htm;

	server_name localhost;

	location / {
		# simply redirect to django instance
		proxy_pass http://127.0.0.1:8000;
		proxy_redirect http://127.0.0.1:8000/ http://127.0.0.1:8080/;
		proxy_redirect http://127.0.0.1/ http://127.0.0.1:8080/;
		proxy_intercept_errors off;
		error_page 502 /__local/502.html;
	}

	location /static/ {
	    # static will first try to call to django (debug mode), otherwise
	    # try the /static folder generated by manage.py collectstatic
	    proxy_pass http://127.0.0.1:8000;
	    proxy_intercept_errors on;
	    proxy_redirect http://127.0.0.1:8000/ http://127.0.0.1:8080/;
	    proxy_redirect http://127.0.0.1/ http://127.0.0.1:8080/;
	    error_page 502 404 =200 /__local$uri;
	}

        location /media/ {
		alias /home/vagrant/media/;
        }

	location /stream/ {
	    # a redirect to the stream server, if running
	    proxy_pass http://127.0.0.1:8888/;
	    proxy_intercept_errors on;
	    proxy_redirect http://127.0.0.1:8000/ http://127.0.0.1:8080/;
            proxy_buffering off;
            proxy_cache off;
            proxy_set_header Connection '';
            proxy_http_version 1.1;
            chunked_transfer_encoding off;
	    error_page 502 /__local/502.html;
	}

	location /__local/static/ {
	    internal;
	    alias /vagrant/static/;
	}

	location /__local/502.html {
	    internal;
	    alias /vagrant/vagrant/502.html;
	}


}
